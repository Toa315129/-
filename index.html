<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sena Booth Pro Max</title>

<!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å -->
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#fffafc;
  --tomato:#ff6347;
  --mint:#a8d5ba;
  --blue:#cbe8ff;
  --pink:#ffd6e8;
  --yellow:#fff6b7;
  --text:#333;
  --shadow:0 8px 24px rgba(0,0,0,0.15);
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);font-family:'Sarabun',sans-serif;}
body{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:12px;}

header{
  text-align:center;margin:20px 0;
}
header h1{
  font-family:'Fredoka One',cursive;
  font-size:3rem;
  color:var(--tomato);
  text-shadow:2px 2px 0 #fff,4px 4px 0 rgba(0,0,0,0.15);
  text-transform:uppercase;
  letter-spacing:2px;
}
nav{
  margin:12px 0;
  display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
}
nav button{
  padding:8px 14px;
  border-radius:20px;
  border:none;
  font-weight:700;
  cursor:pointer;
  background:var(--tomato);
  color:#fff;
  box-shadow:var(--shadow);
  transition:all 0.2s;
}
nav button:hover{background:#ff826d}

/* layout ‡∏´‡∏•‡∏±‡∏Å */
.container{
  display:flex;flex-wrap:wrap;gap:20px;justify-content:center;width:100%;max-width:1200px;
}

/* ‡∏Å‡∏•‡πâ‡∏≠‡∏á */
.camera-wrap{
  flex:1 1 420px;min-width:320px;
  background:#fff;border-radius:20px;
  box-shadow:var(--shadow);padding:14px;
  display:flex;flex-direction:column;align-items:center;gap:10px;
}
.preview{
  position:relative;
  width:100%;aspect-ratio:3/4;
  border-radius:20px;overflow:hidden;
  border:6px solid var(--tomato);
  background:#eee;
}
#video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1);}
.countdown{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  font-size:5rem;font-weight:700;color:#fff;text-shadow:0 0 10px #000;
}
.flash{
  position:absolute;inset:0;background:#fff;opacity:0;transition:opacity 0.2s;
}
.flash.show{opacity:0.9}

.controls{
  display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:6px;
}
.btn,.shutter{
  font-family:'Sarabun',sans-serif;
  padding:10px 14px;border-radius:14px;border:none;cursor:pointer;font-weight:700;
  transition:all .2s;
}
.btn{background:var(--pink);color:var(--text);box-shadow:var(--shadow);}
.btn:hover{background:var(--yellow);}
.btn:disabled{opacity:.5;cursor:not-allowed}
.shutter{
  width:80px;height:80px;border-radius:50%;background:#fff;border:6px solid var(--tomato);
  box-shadow:var(--shadow);
}
.shutter:hover{background:var(--yellow)}

/* ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà */
.gallery{
  flex:0 0 300px;
  background:#fff;border-radius:20px;box-shadow:var(--shadow);padding:14px;
  display:flex;flex-direction:column;align-items:center;gap:10px;
}
.gallery h2{font-size:1.2rem;font-weight:700;color:var(--tomato)}
.thumbs{display:flex;gap:8px;width:100%;justify-content:space-between}
.thumb{
  width:32%;aspect-ratio:3/4;border-radius:12px;overflow:hidden;
  border:3px dashed var(--mint);display:flex;align-items:center;justify-content:center;
  background:#f8f8f8;
}
.thumb img{width:100%;height:100%;object-fit:cover}

/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏≠‡∏ö */
.frames{
  margin-top:12px;
  display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
}
.frame-card{
  flex:1 1 120px;min-width:120px;max-width:150px;
  border-radius:16px;overflow:hidden;cursor:pointer;
  box-shadow:var(--shadow);position:relative;text-align:center;
  background:#fafafa;border:4px solid transparent;
}
.frame-card img{width:100%;height:120px;object-fit:cover}
.frame-card span{
  display:block;padding:6px;font-weight:700;color:var(--text);
}
.frame-card.active{border-color:var(--tomato)}

/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå */
.filters{
  display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px;
}
.filters button{
  padding:6px 12px;border-radius:14px;border:none;cursor:pointer;
  font-weight:600;background:var(--blue);box-shadow:var(--shadow);
}
.filters button.active{background:var(--tomato);color:#fff}

/* ‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå */
.sticker-panel{
  margin-top:10px;display:flex;gap:6px;flex-wrap:wrap;justify-content:center;
}
.sticker{
  font-size:28px;cursor:grab;
  transition:transform .2s;
}
.sticker:active{transform:scale(1.4)}

/* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà export */
.export-controls{
  margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
}
.export-controls button{
  padding:10px 14px;border-radius:14px;border:none;cursor:pointer;font-weight:700;
  background:var(--mint);box-shadow:var(--shadow);
}
.export-controls button:hover{background:var(--yellow)}

.canvas-output{display:none}
</style>
</head>
<body>
<header>
  <h1>Sena Booth</h1>
  <nav>
    <button id="cameraMode">üì∑ ‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
    <button id="uploadMode">üìÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
  </nav>
</header>

<div class="container">
  <div class="camera-wrap">
    <div class="preview" id="preview">
      <video id="video" autoplay playsinline></video>
      <div class="countdown" id="countdown"></div>
      <div class="flash" id="flash"></div>
    </div>

    <div class="controls">
      <div class="shutter" id="shutter" title="‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û"></div>
      <button class="btn" id="retake" disabled>‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</button>
      <button class="btn" id="switch">‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
      <button class="btn" id="upload">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
      <button class="btn" id="download" disabled>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
      <input type="file" id="fileInput" accept="image/*" multiple hidden>
    </div>

    <div class="filters" id="filters">
      <button data-filter="none" class="active">‡∏õ‡∏Å‡∏ï‡∏¥</button>
      <button data-filter="grayscale(100%)">‡∏Ç‡∏≤‡∏ß‡∏î‡∏≥</button>
      <button data-filter="sepia(90%)">‡∏ã‡∏µ‡πÄ‡∏õ‡∏µ‡∏¢</button>
      <button data-filter="contrast(120%) brightness(110%) saturate(120%)">‡∏™‡∏î‡πÉ‡∏™</button>
      <button data-filter="hue-rotate(300deg) saturate(150%)">‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏ä‡∏°‡∏û‡∏π</button>
    </div>

    <div class="sticker-panel">
      <div class="sticker">‚≠ê</div>
      <div class="sticker">üíñ</div>
      <div class="sticker">üçÄ</div>
      <div class="sticker">üå∏</div>
      <div class="sticker">‚ú®</div>
      <div class="sticker">üéâ</div>
    </div>

    <div class="export-controls">
      <button id="downloadPNG">‚¨áÔ∏è PNG</button>
      <button id="downloadPDF">‚¨áÔ∏è PDF</button>
    </div>
  </div>

  <div class="gallery">
    <h2>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 3 ‡∏†‡∏≤‡∏û</h2>
    <div class="thumbs" id="thumbs">
      <div class="thumb" id="t1"><span>1</span></div>
      <div class="thumb" id="t2"><span>2</span></div>
      <div class="thumb" id="t3"><span>3</span></div>
    </div>
    <div class="frames">
      <div class="frame-card active" data-frame="polaroid">
        <img src="https://i.ibb.co/DY6k7J3/polaroid.jpg" alt="">
        <span>Polaroid</span>
      </div>
      <div class="frame-card" data-frame="clover">
        <img src="https://i.ibb.co/wc9vh8V/clover.jpg" alt="">
        <span>Clover</span>
      </div>
      <div class="frame-card" data-frame="retro">
        <img src="https://i.ibb.co/smKdd6x/retro.jpg" alt="">
        <span>Retro</span>
      </div>
      <div class="frame-card" data-frame="cute">
        <img src="https://i.ibb.co/M2VfMWG/cute.jpg" alt="">
        <span>Cute</span>
      </div>
    </div>
  </div>
</div>

<audio id="snap" src="https://cdn.jsdelivr.net/gh/naptha/talkdemo/snap.mp3" preload="auto"></audio>

<canvas id="canvasOutput" class="canvas-output"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
(async()=>{
// DOM refs
const video=document.getElementById('video');
const shutter=document.getElementById('shutter');
const retakeBtn=document.getElementById('retake');
const switchBtn=document.getElementById('switch');
const downloadBtn=document.getElementById('download');
const uploadBtn=document.getElementById('upload');
const fileInput=document.getElementById('fileInput');
const countdownEl=document.getElementById('countdown');
const flash=document.getElementById('flash');
const snap=document.getElementById('snap');
const thumbs=[document.getElementById('t1'),document.getElementById('t2'),document.getElementById('t3')];
const filters=document.querySelectorAll('#filters button');
const frameCards=document.querySelectorAll('.frame-card');
const canvasOutput=document.getElementById('canvasOutput');

let stream=null,useFront=true,captures=[null,null,null];
let currentFilter='none';
let currentFrame='polaroid';

async function startCamera(){
  if(stream){stream.getTracks().forEach(t=>t.stop()); stream=null;}
  try{
    stream=await navigator.mediaDevices.getUserMedia({
      video:{facingMode:useFront?'user':'environment'},audio:false});
    video.srcObject=stream; await video.play();
  }catch(e){alert('‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: '+e.message);}
}
if(navigator.mediaDevices) await startCamera();

// Switch cam
switchBtn.addEventListener('click',async()=>{useFront=!useFront;await startCamera();});

// Filter
filters.forEach(btn=>{
  btn.addEventListener('click',()=>{
    filters.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter=btn.dataset.filter;
  });
});

// Frame select
frameCards.forEach(c=>{
  c.addEventListener('click',()=>{
    frameCards.forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    currentFrame=c.dataset.frame;
  });
});

function captureFrame(){
  const vw=video.videoWidth,vh=video.videoHeight;
  const c=document.createElement('canvas'); c.width=vw; c.height=vh;
  const ctx=c.getContext('2d');
  ctx.translate(c.width,0); ctx.scale(-1,1);
  ctx.filter=currentFilter;
  ctx.drawImage(video,0,0,vw,vh);
  return c.toDataURL('image/png');
}

function showCount(num){countdownEl.textContent=num;}
function hideCount(){countdownEl.textContent='';}
function doFlash(){flash.classList.add('show');setTimeout(()=>flash.classList.remove('show'),180);snap.play().catch(()=>{});}

async function takeSequence(){
  captures=[null,null,null];
  thumbs.forEach((t,i)=> t.innerHTML=`<span>${i+1}</span>`);
  retakeBtn.disabled=true; downloadBtn.disabled=true; shutter.style.pointerEvents='none';
  for(let i=0;i<3;i++){
    for(let s=3;s>=1;s--){showCount(s);await new Promise(r=>setTimeout(r,1000));}
    hideCount(); doFlash();
    const data=captureFrame();
    captures[i]=data;
    thumbs[i].innerHTML=`<img src="${data}">`;
    if(i<2) await new Promise(r=>setTimeout(r,1000));
  }
  retakeBtn.disabled=false; downloadBtn.disabled=false; shutter.style.pointerEvents='';
}
shutter.addEventListener('click',takeSequence);

retakeBtn.addEventListener('click',()=>{
  captures=[null,null,null];
  thumbs.forEach((t,i)=> t.innerHTML=`<span>${i+1}</span>`);
  downloadBtn.disabled=true;
});

uploadBtn.addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change',async(e)=>{
  const files=[...e.target.files].slice(0,3);
  if(files.length<3){alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏£‡∏π‡∏õ');return;}
  captures=[null,null,null];
  for(let i=0;i<3;i++){
    const file=files[i];
    const reader=new FileReader();
    await new Promise((res,rej)=>{
      reader.onload=()=>{captures[i]=reader.result;thumbs[i].innerHTML=`<img src="${reader.result}">`;res();};
      reader.onerror=rej;
      reader.readAsDataURL(file);
    });
  }
  retakeBtn.disabled=false; downloadBtn.disabled=false;
});

async function buildFinalCanvas(){
  const W=1200,H=1800;
  canvasOutput.width=W;canvasOutput.height=H;
  const ctx=canvasOutput.getContext('2d');
  ctx.fillStyle='#fff';ctx.fillRect(0,0,W,H);

  ctx.fillStyle='#ff6347';ctx.font='72px Fredoka One';ctx.textAlign='center';
  ctx.fillText('SENA BOOTH',W/2,90);

  const marginX=100,gap=30,topY=160;
  const innerW=W-marginX*2;
  const availableH=H-topY-120;
  const boxH=Math.floor((availableH-gap*2)/3);

  for(let i=0;i<3;i++){
    if(!captures[i]) continue;
    const img=new Image();await new Promise(r=>{img.onload=r;img.src=captures[i];});
    const scale=Math.min(innerW/img.width, boxH/img.height);
    const iw=img.width*scale,ih=img.height*scale;
    const dx=marginX+(innerW-iw)/2,dy=topY+i*(boxH+gap)+(boxH-ih)/2;

    ctx.save();ctx.filter=currentFilter;
    ctx.drawImage(img,dx,dy,iw,ih);ctx.restore();

    // ‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ theme
    ctx.lineWidth=10;
    if(currentFrame==='polaroid'){
      ctx.strokeStyle='#eee';ctx.strokeRect(dx-10,dy-10,iw+20,ih+60);
      ctx.fillStyle='#333';ctx.font='20px Sarabun';ctx.textAlign='center';
      ctx.fillText('Sena Booth',dx+iw/2,dy+ih+30);
    }
    else if(currentFrame==='clover'){
      ctx.strokeStyle='#6cc48d';ctx.strokeRect(dx-8,dy-8,iw+16,ih+16);
      ctx.fillText('üçÄ',dx-20,dy+20);
    }
    else if(currentFrame==='retro'){
      ctx.strokeStyle='#ff00ff';ctx.shadowColor='#0ff';ctx.shadowBlur=20;
      ctx.strokeRect(dx-8,dy-8,iw+16,ih+16);ctx.shadowBlur=0;
    }
    else if(currentFrame==='cute'){
      ctx.strokeStyle='#ff9acb';ctx.strokeRect(dx-8,dy-8,iw+16,ih+16);
      ctx.fillText('üíñ',dx+iw-10,dy+ih+20);
    }
  }

  ctx.fillStyle='#444';ctx.font='24px Sarabun';
  ctx.fillText('@sena-booth',W/2,H-40);
  return canvasOutput;
}

// Download PNG
document.getElementById('downloadPNG').addEventListener('click',async()=>{
  const c=await buildFinalCanvas();
  const a=document.createElement('a');
  a.href=c.toDataURL('image/png');
  a.download='sena_booth.png';
  a.click();
});

// Download PDF
document.getElementById('downloadPDF').addEventListener('click',async()=>{
  const c=await buildFinalCanvas();
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF({orientation:'portrait',unit:'px',format:[c.width,c.height]});
  pdf.addImage(c.toDataURL('image/png'),'PNG',0,0,c.width,c.height);
  pdf.save('sena_booth.pdf');
});
})();
</script>
</body>
</html>
