<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sena Booth ‚Äî Photobooth Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- html2pdf.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö export PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* ===== Variables ===== */
:root{
  --bg-cream:#f5f2e9;
  --accent-clover:#3ba776;
  --accent-cool:#8ba6d8;
  --accent-retro:#f6a85f;
  --muted:#ffffff;
  --text:#243238;
  --glass: rgba(255,255,255,0.6);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Poppins",sans-serif;background:var(--bg-cream);color:var(--text)}
button{font-family:inherit;cursor:pointer}

/* ===== App container ===== */
.app{
  max-width:1100px;margin:22px auto;padding:20px;
  background:#fff;border-radius:18px;
  box-shadow:0 18px 50px rgba(16,24,40,0.12);
  overflow:hidden;border-top:8px solid var(--accent-clover);
}

/* Header */
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;}
.brand{font-weight:700;font-size:28px;color:var(--accent-cool);text-transform:uppercase;letter-spacing:1px;}
.top-actions{display:flex;gap:8px;align-items:center}
.select, .small-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff}

/* Layout */
.layout{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap}
.left{flex:1 1 66%;min-width:320px}
.right{flex:0 0 32%;min-width:280px}

/* Preview area */
.preview-wrap{border-radius:14px;overflow:hidden;border:1px solid rgba(0,0,0,0.04);background:#fafafa;padding:12px}
.preview{width:100%;aspect-ratio:3/4;border-radius:12px;overflow:hidden;position:relative;background:#000;display:flex;align-items:center;justify-content:center;}
video#video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1);display:block}
.preview .overlay-text{position:absolute;left:50%;top:12%;transform:translateX(-50%);min-width:40%;text-align:center;color:var(--accent-cool);font-weight:700;font-size:34px;text-transform:uppercase;user-select:text;padding:6px;border-radius:8px;}
.preview .overlay-text[contenteditable="true"]:focus{outline:2px dashed rgba(139,166,216,0.35);background:rgba(255,255,255,0.6)}
.sticker-layer{position:absolute;inset:0;pointer-events:none}
.countdown{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:4.2rem;color:#fff;text-shadow:0 6px 18px rgba(0,0,0,0.5);pointer-events:none}
.flash{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;transition:opacity .16s}
.flash.show{opacity:0.9}

/* Controls */
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:12px}
.shutter{width:84px;height:84px;border-radius:50%;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,var(--accent-cool),#6ea1d9);color:#fff;font-weight:800;border:none;
  box-shadow:0 12px 28px rgba(139,166,216,0.2);}
.btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff}
.btn.primary{background:linear-gradient(180deg,#ff9aa2,#ff6f61);color:#fff;border:none}
.inline-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

/* Panels */
.panel{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 8px 20px rgba(16,24,40,0.04)}
.panel h4{margin:0 0 8px 0;font-size:14px;color:var(--text)}
.thumbs{display:flex;gap:8px;justify-content:space-between}
.thumb{width:32%;aspect-ratio:3/4;border-radius:10px;background:#fafafa;display:flex;align-items:center;justify-content:center;border:2px solid rgba(0,0,0,0.04);overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}

/* Stickers */
.sticker-btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff}
.sticker-item{position:absolute;pointer-events:auto;user-select:none;font-size:28px;transform-origin:center}

/* Responsive */
@media (max-width:880px){
  .layout{flex-direction:column}
  .left,.right{flex:1 1 100%}
  .header{flex-direction:column;gap:8px}
}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="brand">Sena Booth</div>
    <div class="top-actions">
      <select id="filterSelect" class="select">
        <option value="none">Filter: None</option>
        <option value="bw">B/W</option>
        <option value="sepia">Sepia</option>
        <option value="pink">Soft Pink</option>
        <option value="warm">Warm</option>
      </select>
      <button id="shareBtn" class="btn">Share</button>
    </div>
  </header>

  <main class="layout">
    <section class="left">
      <div class="preview-wrap panel">
        <div class="preview" id="preview">
          <video id="video" autoplay playsinline></video>
          <div id="overlayText" class="overlay-text" contenteditable="true">I WILL GET BETTER</div>
          <div id="stickerLayer" class="sticker-layer"></div>
          <div class="countdown" id="countdown"></div>
          <div id="flash" class="flash"></div>
        </div>

        <div class="controls">
          <button id="shutter" class="shutter">‚óè</button>
          <div class="inline-row">
            <button id="switchBtn" class="btn">Switch Camera</button>
            <button id="retake" class="btn" disabled>Retake</button>
            <button id="uploadBtn" class="btn">Upload 3 Photos</button>
            <input id="fileInput" type="file" accept="image/*" multiple style="display:none">
          </div>
        </div>

        <div class="export-row" style="margin-top:12px">
          <button id="downloadPNG" class="btn primary" disabled>Download PNG</button>
          <button id="downloadPDF" class="btn" disabled>Save as PDF</button>
          <button id="previewPrint" class="btn">Print</button>
        </div>
      </div>
    </section>

    <aside class="right">
      <div class="panel">
        <h4>Preview (3)</h4>
        <div class="thumbs" id="thumbs">
          <div class="thumb" id="t1">1</div>
          <div class="thumb" id="t2">2</div>
          <div class="thumb" id="t3">3</div>
        </div>
      </div>

      <div class="panel">
        <h4>Stickers</h4>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="sticker-btn" data-sticker="‚≠ê">‚≠ê</button>
          <button class="sticker-btn" data-sticker="üíñ">üíñ</button>
          <button class="sticker-btn" data-sticker="üçÄ">üçÄ</button>
          <button class="sticker-btn" data-sticker="‚ú®">‚ú®</button>
          <button class="sticker-btn" data-sticker="‚ùÑÔ∏è">‚ùÑÔ∏è</button>
          <button class="sticker-btn" data-sticker="clear">clear</button>
        </div>
      </div>
    </aside>
  </main>

  <footer style="padding:12px;text-align:center;color:rgba(0,0,0,0.5)">powered by sena booth ‚ú®</footer>
</div>

<script>
/* === Photobooth Script === */
const video = document.getElementById('video');
const shutter = document.getElementById('shutter');
const switchBtn = document.getElementById('switchBtn');
const retakeBtn = document.getElementById('retake');
const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('fileInput');
const thumbs = [document.getElementById('t1'),document.getElementById('t2'),document.getElementById('t3')];
const countdownEl = document.getElementById('countdown');
const flashEl = document.getElementById('flash');
const overlayText = document.getElementById('overlayText');
const stickerLayer = document.getElementById('stickerLayer');
const filterSelect = document.getElementById('filterSelect');
const downloadPNG = document.getElementById('downloadPNG');
const downloadPDF = document.getElementById('downloadPDF');
const previewPrint = document.getElementById('previewPrint');
const shareBtn = document.getElementById('shareBtn');

let stream=null, captures=[null,null,null], useFront=true;

/* Start camera */
async function startCamera(){
  if(stream){stream.getTracks().forEach(t=>t.stop());}
  stream = await navigator.mediaDevices.getUserMedia({video:{facingMode: useFront?"user":"environment"}});
  video.srcObject = stream;
}
startCamera();

/* Switch camera */
switchBtn.onclick=()=>{useFront=!useFront;startCamera();};

/* Capture helper */
function captureFrame(){
  const c=document.createElement('canvas');
  c.width=video.videoWidth;c.height=video.videoHeight;
  const ctx=c.getContext('2d');
  ctx.translate(c.width,0);ctx.scale(-1,1);
  ctx.drawImage(video,0,0);
  return c.toDataURL('image/png');
}

/* Countdown + capture 3 */
async function takeSequence(){
  captures=[null,null,null];
  for(let i=0;i<3;i++){
    for(let s=3;s>=1;s--){countdownEl.textContent=s;await new Promise(r=>setTimeout(r,1000));}
    countdownEl.textContent="";
    flashEl.classList.add("show");setTimeout(()=>flashEl.classList.remove("show"),200);
    const shot=captureFrame();captures[i]=shot;
    thumbs[i].innerHTML=`<img src="${shot}">`;
  }
  downloadPNG.disabled=false;downloadPDF.disabled=false;retakeBtn.disabled=false;
}
shutter.onclick=takeSequence;

/* Retake */
retakeBtn.onclick=()=>{captures=[null,null,null];thumbs.forEach((t,i)=>t.textContent=i+1);downloadPNG.disabled=true;downloadPDF.disabled=true;};

/* Upload 3 */
uploadBtn.onclick=()=>fileInput.click();
fileInput.onchange=async(e)=>{
  const files=[...e.target.files].slice(0,3);
  if(files.length<3){alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏£‡∏π‡∏õ");return;}
  for(let i=0;i<3;i++){
    const r=new FileReader();
    r.onload=()=>{captures[i]=r.result;thumbs[i].innerHTML=`<img src="${r.result}">`;};
    r.readAsDataURL(files[i]);
  }
  downloadPNG.disabled=false;downloadPDF.disabled=false;retakeBtn.disabled=false;
};

/* Filter */
filterSelect.onchange=()=>{
  const f=filterSelect.value;
  video.style.filter=(f==="bw")?"grayscale(1)":
    (f==="sepia")?"sepia(.6)":
    (f==="pink")?"brightness(1.1) saturate(1.3)":
    (f==="warm")?"contrast(1.2) sepia(.2)":"";
};

/* Stickers */
document.querySelectorAll(".sticker-btn").forEach(b=>{
  b.onclick=()=>{
    if(b.dataset.sticker==="clear"){stickerLayer.innerHTML="";return;}
    const el=document.createElement("div");
    el.className="sticker-item";el.textContent=b.dataset.sticker;
    el.style.left="50%";el.style.top="50%";el.style.position="absolute";
    el.style.transform="translate(-50%,-50%)";stickerLayer.appendChild(el);
    el.onmousedown=e=>{
      const move=ev=>{el.style.left=ev.offsetX+"px";el.style.top=ev.offsetY+"px";};
      document.onmousemove=move;
      document.onmouseup=()=>{document.onmousemove=null;};
    };
  };
});

/* Export PNG */
downloadPNG.onclick=()=>{
  const c=document.createElement("canvas");c.width=1200;c.height=1800;
  const ctx=c.getContext("2d");
  ctx.fillStyle="#fff";ctx.fillRect(0,0,c.width,c.height);
  ctx.font="48px Poppins";ctx.fillStyle="#3ba776";ctx.textAlign="center";
  ctx.fillText("SENA BOOTH",c.width/2,80);
  captures.forEach(async(img,i)=>{
    if(!img)return;
    const im=new Image();im.src=img;
    im.onload=()=>{ctx.drawImage(im,150,150+i*550,900,500);};
  });
  setTimeout(()=>{
    const a=document.createElement("a");
    a.href=c.toDataURL();a.download="sena_booth.png";a.click();
  },500);
};

/* Export PDF */
downloadPDF.onclick=()=>{
  const element=document.createElement("div");
  element.innerHTML=`<h2 style="text-align:center">SENA BOOTH</h2>
    ${captures.map(c=>c?`<img src="${c}" style="width:100%;margin:10px 0">`:"").join("")}`;
  html2pdf().from(element).set({margin:10,filename:"sena_booth.pdf"}).save();
};

/* Print */
previewPrint.onclick=()=>{
  const w=window.open("");
  w.document.write(captures.map(c=>c?`<img src="${c}" style="width:100%">`:"").join(""));
  w.print();
};

/* Share */
shareBtn.onclick=async()=>{
  if(!captures[0])return alert("‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô");
  const res=await fetch(captures[0]);const blob=await res.blob();
  const file=new File([blob],"sena.png",{type:"image/png"});
  if(navigator.canShare&&navigator.canShare({files:[file]})){await navigator.share({files:[file],title:"Sena Booth"});}
  else{alert("‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö share");}
};
</script>
</body>
</html>
